"undefined"!=typeof Worker&&null!==Worker||!console||console.log("Warning: Browser does not support web workers."),function(){function a(a,b){return!(b>a||a>b)}function b(a,b){if("function"!=typeof b)throw new Error("Expected callback function as parameter.");for(var c=0;c<a.length;c++){var d=a[c];if(d==b)return}a.push(b)}function c(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.apply(null,b)}}var d="this.onmessage = function (event) {  var fnData = event.data.function;  var scripts = event.data.importScripts;  var fn = Function.apply(null, fnData.args.concat(fnData.body));  if(importScripts && scripts.length > 0) {    importScripts.apply(null, scripts);  }  fn(event.data.parameter, function(result) {    postMessage(result);  });}",e="data:text/javascript;charset=utf-8,"+encodeURI(d),f=window.createBlobURL||window.createObjectURL;if(!f){var g=window.URL||window.webkitURL;if(!g)throw new Error("No Blob creation implementation found.");f=g.createObjectURL}if("function"==typeof BlobBuilder&&"function"==typeof f){var h=new BlobBuilder;h.append(d),e=f(h.getBlob())}else if("function"==typeof Blob&&"function"==typeof f){var i=new Blob([d],{type:"text/javascript"});e=f(i)}var j=function(a,b,c){if(this.param=b,this.transferBuffers=c,this.importScripts=[],this.callbacksStart=[],this.callbacksDone=[],this.callbacksError=[],"function"==typeof a){var d=a.toString();this.scriptArgs=d.substring(d.indexOf("(")+1,d.indexOf(")")).split(","),this.scriptBody=d.substring(d.indexOf("{")+1,d.lastIndexOf("}")),this.scriptFile=void 0}else this.scriptArgs=void 0,this.scriptBody=void 0,this.scriptFile=a};j.prototype={getParameter:function(){return this.param},getImportScripts:function(){return this.importScripts},setImportScripts:function(a){this.importScripts=a},getBuffersToTransfer:function(){return this.transferBuffers},getFunction:function(){return this.scriptArgs?{args:this.scriptArgs,body:this.scriptBody}:void 0},getScriptFile:function(){return this.scriptFile},functionallyEquals:function(b){return b&&b instanceof j&&a(b.scriptArgs,this.scriptArgs)&&b.body==this.body&&b.scriptFile==this.scriptFile},triggerStart:function(){c(this.callbacksStart,[])},triggerDone:function(a){c(this.callbacksDone,[a])},triggerError:function(a){c(this.callbacksError,[a])},start:function(a){return b(this.callbacksStart,a),this},done:function(a){return b(this.callbacksDone,a),this},error:function(a){return b(this.callbacksError,a),this}};var k=function(a){this.threadPool=a,this.worker=void 0,this.currentJob=void 0,this.lastJob=void 0};k.prototype={terminate:function(){this.worker&&(this.worker.terminate(),this.worker=void 0)},run:function(a){function b(a){g.currentJob.triggerDone(a.data),g.threadPool.triggerDone(a.data),f()}function c(a){g.currentJob.triggerError(a),g.threadPool.triggerError(a),f()}function f(){g.currentJob=void 0,g.lastJob=a,g.threadPool._threadDone(g)}var g=this,h=!0,i=a.getBuffersToTransfer();if(this.currentJob=a,i||(i=[]),this.worker&&(this.lastJob&&this.lastJob.functionallyEquals(a)?h=!1:(this.worker.terminate(),this.worker=void 0)),a.triggerStart(),a.getScriptFile())h&&(this.worker=new Worker(a.getScriptFile()),this.worker.addEventListener("message",b,!1),this.worker.addEventListener("error",c,!1)),this.worker.postMessage(a.getParameter(),i);else{if(h){try{this.worker=new Worker(e)}catch(j){var k=window.navigator.userAgent.indexOf("MSIE ")>-1,l=window.navigator.userAgent.indexOf("Trident/")>-1;if(!k&&!l)throw j;if(!this.threadPool.evalWorkerUrl)throw new Error("No eval worker script set (required for IE compatibility).");this.worker=new Worker(this.threadPool.evalWorkerUrl),this.worker.postMessage(d)}this.worker.addEventListener("message",b,!1),this.worker.addEventListener("error",c,!1)}this.worker.postMessage({"function":a.getFunction(),importScripts:a.getImportScripts(),parameter:a.getParameter()},i)}}};var l=function(a,b){a=a||l.defaultSize,b=b||"",this.size=a,this.evalWorkerUrl=b,this.pendingJobs=[],this.idleThreads=[],this.activeThreads=[],this.callbacksDone=[],this.callbacksError=[];for(var c=0;a>c;c++)this.idleThreads.push(new k(this))};l.prototype={terminateAll:function(){for(var a=0;a<this.idleThreads.length;a++)this.idleThreads[a].terminate();for(a=0;a<this.activeThreads.length;a++)this.activeThreads[a]&&this.activeThreads[a].terminate()},run:function(){var a,b,c,d,e,f,g=[].slice.call(arguments);if(arguments.length<1)throw new Error("run(): Too few parameters.");if("string"==typeof g[0])a=g.shift();else{if("object"==typeof g[0]&&g[0]instanceof Array&&(c=g.shift()),!(g.length>0&&"function"==typeof g[0]))throw new Error("run(): Missing obligatory thread logic function.");b=g.shift()}if(g.length>0&&"function"!=typeof g[0]&&(d=g.shift()),g.length>0&&"function"!=typeof g[0]&&(e=g.shift()),g.length>0&&"function"==typeof g[0]&&(f=g.shift()),g.length>0)throw new Error("run(): Unrecognized parameters: "+g);var h;a?h=new j(a,d,e):(h=new j(b,d,e),c&&c.length>0&&h.setImportScripts(c)),f&&h.done(f),this.pendingJobs.push(h);var i=this;return setTimeout(function(){i.runJobs()},0),h},runJobs:function(){if(this.idleThreads.length>0&&this.pendingJobs.length>0){var a=this.idleThreads.shift();this.activeThreads.push(a);var b=this.pendingJobs.shift();a.run(b)}},_threadDone:function(a){this.idleThreads.unshift(a),this.activeThreads.splice(this.activeThreads.indexOf(a),1),this.runJobs()},triggerDone:function(a){c(this.callbacksDone,[a])},triggerError:function(a){c(this.callbacksError,[a])},clearDone:function(){this.callbacksDone=[]},done:function(a){return b(this.callbacksDone,a),this},error:function(a){return b(this.callbacksError,a),this}},l.defaultSize=8,"function"==typeof define?define([],l):"object"==typeof module?module.exports=l:"object"==typeof window&&(window.ThreadPool=l)}();